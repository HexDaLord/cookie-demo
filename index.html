<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wie Websites dich erkennen ‚Äî Interaktive Demo (√úberarbeitet)</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    :root{
      --bg:#f6f8fa; --card:#ffffff; --primary:#4a90e2; --muted:#6b7280; --glass: rgba(255,255,255,0.6);
    }
    [data-theme="dark"]{
      --bg:#0f1724; --card:#0b1220; --primary:#60a5fa; --muted:#9ca3af; --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    body{font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif; margin:0; background:var(--bg); color:var(--muted);}
    header{background:linear-gradient(90deg,var(--primary), #2e6fb8); color:white; padding:1.25rem 1rem; display:flex; gap:1rem; align-items:center; justify-content:space-between}
    header .brand{display:flex; gap:.75rem; align-items:center}
    header h1{font-size:1.1rem; margin:0; color:white}
    header p{margin:0; font-size:.86rem; opacity:.95}

    main{max-width:1100px; margin:1.25rem auto; padding:1rem;}
    .layout{display:grid; grid-template-columns: 380px 1fr; gap:1rem} /* Sidebar breiter: mehr Platz f√ºr die Schritte */

    /* Sidebar */
    .sidebar{position:sticky; top:1rem; align-self:start}
    .card{background:var(--card); border-radius:12px; padding:1rem; box-shadow:0 6px 20px rgba(2,6,23,0.08); color:var(--muted)}
    .card h2{color:var(--primary); margin:0 0 .5rem 0}
    .muted{font-size:.9rem; color:var(--muted)}

    /* Progress */
    .progress{display:flex; gap:.5rem; align-items:center; margin-top:.5rem; overflow-x:auto; padding-bottom:.25rem} /* erlauben horizontales Scrollen bei sehr kleinen Bildschirmen */
    .step{flex:0 1 auto; min-width:68px; background:var(--glass); padding:.45rem .6rem; border-radius:8px; text-align:center; font-weight:600; color:var(--muted);} /* feste Mindestbreite, damit 1‚Äì5 besser sichtbar */
    .step.active{background:linear-gradient(90deg,var(--primary), #2e6fb8); color:white}

    /* Controls */
    .controls{display:flex; gap:.5rem; flex-wrap:wrap; margin-top:.7rem}
    button{background:var(--primary); color:white; border:none; padding:.5rem .75rem; border-radius:8px; cursor:pointer; font-weight:600}
    .btn-ghost{background:transparent; color:var(--primary); border:1px solid var(--glass)}
    button:active{transform:translateY(1px)}

    /* Content area */
    .content{display:flex; flex-direction:column; gap:1rem}
    section{padding:1rem; border-radius:12px; background:var(--card); box-shadow:0 6px 20px rgba(2,6,23,0.04)}
    section h3{margin-top:0; color:var(--primary)}
    .info{background:linear-gradient(180deg, rgba(234,244,255,0.5), transparent); padding:.6rem; border-left:4px solid var(--primary); border-radius:8px; color:var(--muted)}
    pre{background:rgba(0,0,0,0.03); padding:.75rem; border-radius:8px; overflow:auto; font-size:.92rem; color:var(--muted)}

    /* form */
    .form-row{display:flex; gap:.5rem; margin-top:.6rem}
    input[type=text], input[type=password]{flex:1; padding:.5rem .6rem; border-radius:8px; border:1px solid #e6edf5; font-size:.95rem}
    label{font-weight:600; font-size:.95rem; color:var(--muted)}

    /* small screens */
    @media (max-width:880px){ .layout{grid-template-columns:1fr; } .sidebar{position:static} }

    /* map */
    #map{height:280px; border-radius:8px; margin-top:.6rem}

    footer{text-align:center; font-size:.82rem; color:var(--muted); margin-top:1rem}

    /* cookie table */
    table{width:100%; border-collapse:collapse; margin-top:.6rem}
    th,td{padding:.45rem .5rem; text-align:left; border-bottom:1px solid rgba(0,0,0,0.05); font-size:.9rem}
    th{color:var(--muted)}

    /* small badges */
    .badge{display:inline-block; padding:.2rem .45rem; border-radius:999px; font-size:.78rem; background:var(--glass); color:var(--muted)}
  </style>
</head>
<body data-theme="light">
  <header>
    <div class="brand">
      <div style="font-size:1.5rem">üç™</div>
      <div>
        <h1>Wie Websites dich erkennen</h1>
        <p>Interaktive Unterrichts-Demo ‚Äì Schulstufe: 9. Klasse / AHS 5. Klasse</p>
      </div>
    </div>
    <div style="display:flex; gap:.6rem; align-items:center">
      <div class="muted" id="welcome-text">Willkommen!</div>
      <button id="theme-toggle" class="btn-ghost">Dark</button>
    </div>
  </header>

  <main>
    <div class="layout">
      <aside class="sidebar">
        <div class="card">
          <h2>Schritt-f√ºr-Schritt</h2>
          <div class="muted">F√ºhre die Schritte durch, um Cookies & Tracking zu verstehen.</div>
          <div class="progress" id="progress">
            <div class="step" data-step="1">1. Cookies</div>
            <div class="step" data-step="2">2. Ger√§t</div>
            <div class="step" data-step="3">3. Standort</div>
            <div class="step" data-step="4">4. Tracking</div>
            <div class="step" data-step="5">5. Login</div>
          </div>

          <div style="margin-top:.8rem" class="muted">Schnellaktionen</div>
          <div class="controls">
            <button onclick="showAllCookies()">Cookies anzeigen</button>
            <button onclick="clearAllCookies()" class="btn-ghost">Alle l√∂schen</button>
            <button onclick="simulateVisit()" class="btn-ghost">Seite neu laden (sim.)</button>
          </div>

          <div style="margin-top:.8rem" class="muted">Cookie-√úbersicht</div>
          <div id="cookie-table"></div>
        </div>

        <div style="height:1rem"></div>

        <div class="card">
          <h2>Session vs Persistent</h2>
          <div class="muted">Session-Cookies existieren nur w√§hrend einer Browser-Sitzung. Persistente Cookies haben ein Ablaufdatum.</div>
          <div style="margin-top:.6rem; display:flex; gap:.5rem">
            <button onclick="setPersistentDemo()">Persistent setzen</button>
            <button onclick="setSessionDemo()" class="btn-ghost">Session setzen</button>
          </div>
        </div>
      </aside>

      <section class="content">
        <section class="card">
          <h3>üç™ Cookies ‚Äì pers√∂nliche Begr√º√üung & Demo</h3>
          <div class="info">Diese Sektion zeigt wie persistent gespeicherte Cookies (z. B. Name) und Session-Cookies (Login-Sitzung) funktionieren. Es werden <b>keine</b> echten Tracker gesetzt.</div>

          <div style="margin-top:.6rem">
            <div class="form-row">
              <input id="name-input" type="text" placeholder="Name (z. B. Anna)" />
              <button onclick="saveNamePersistent()">Als Persistent speichern</button>
              <button onclick="saveNameSession()" class="btn-ghost">Als Session speichern</button>
            </div>
            <div style="margin-top:.5rem" class="muted">Aktuelle Begr√º√üung:</div>
            <pre id="greeting">Hallo, Sch√ºler!</pre>
          </div>
        </section>

        <section class="card">
          <h3>üíª Ger√§tedaten</h3>
          <div class="info">Technische Informationen, die Websites mit JavaScript auslesen k√∂nnen.</div>
          <div style="margin-top:.6rem; display:flex; gap:.5rem; align-items:center">
            <button onclick="showDeviceInfo()">Daten anzeigen</button>
            <button onclick="clearDeviceInfo()" class="btn-ghost">L√∂schen</button>
          </div>
          <pre id="device-info">Noch keine Daten angezeigt.</pre>
        </section>

        <section class="card">
          <h3>üìç Standort (nur mit Zustimmung)</h3>
          <div class="info">Wenn erlaubt, zeigt die Karte ungef√§hr, wo sich das Ger√§t befindet.</div>
          <div style="margin-top:.6rem; display:flex; gap:.5rem; align-items:center">
            <button onclick="getLocation()">Standort abfragen</button>
            <button onclick="clearLocation()" class="btn-ghost">Karte verstecken</button>
          </div>
          <pre id="location-info">Noch keine Standortdaten.</pre>
          <div id="map" style="display:none"></div>
        </section>

        <section class="card">
          <h3>üì¢ Tracking-Simulation</h3>
          <div class="info">Simuliere ein Werbecookie (tracking_id) und beobachte, wie eine Seite dich bei einem erneuten Besuch "wiedererkennen" k√∂nnte.</div>
          <div style="margin-top:.6rem; display:flex; gap:.5rem; align-items:center">
            <button onclick="setTracking()">Tracking setzen</button>
            <button onclick="simulateAd()" class="btn-ghost">Simuliere Ad-Targeting</button>
            <button onclick="clearTracking()" class="btn-ghost">Tracking l√∂schen</button>
          </div>
          <pre id="tracking-info">Tracking nicht gesetzt.</pre>
        </section>

        <section class="card">
          <h3>üîê Mini-Register / Login (lokal & ohne Server)</h3>
          <div class="info">Registrieren & Anmelden werden nur lokal simuliert. Registrierte Daten werden im <b>localStorage</b> gespeichert. Die Login-Sitzung demonstriert einen Session-Cookie.</div>

          <div style="margin-top:.6rem">
            <div class="form-row">
              <input id="reg-username" type="text" placeholder="Benutzername" />
              <input id="reg-password" type="password" placeholder="Passwort" />
              <button onclick="registerUser()">Registrieren</button>
            </div>

            <div class="form-row" style="margin-top:.5rem">
              <input id="login-username" type="text" placeholder="Benutzername" />
              <input id="login-password" type="password" placeholder="Passwort" />
              <button onclick="loginUser()">Login</button>
              <button onclick="logoutUser()" class="btn-ghost">Logout</button>
            </div>

            <div style="margin-top:.6rem" class="muted">Session-Info:</div>
            <pre id="session-info">Nicht eingeloggt.</pre>
          </div>
        </section>

        <footer>¬© Unterrichts-Demo ‚Äì Keine Daten werden an Server √ºbertragen.</footer>
      </section>
    </div>
  </main>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    /* ----------------------------- Helpers ----------------------------- */
    function setCookie(name,value,days){
      let s = encodeURIComponent(value) + "; path=/";
      if(typeof days === 'number'){
        const d = new Date(); d.setTime(d.getTime() + days*24*60*60*1000);
        s += "; expires="+d.toUTCString();
      }
      document.cookie = name + '=' + s;
      renderCookieTable();
    }
    function setSessionCookie(name,value){
      // session cookie: no expires set -> expires at end of browser session
      document.cookie = name + '=' + encodeURIComponent(value) + '; path=/';
      renderCookieTable();
    }
    function getCookie(name){
      const match = document.cookie.match('(^|;)\\s*'+name+'=([^;]+)');
      return match ? decodeURIComponent(match.pop()) : null;
    }
    function deleteCookie(name){ document.cookie = name + '=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC'; renderCookieTable(); }
    function clearAllCookies(){document.cookie.split(';').forEach(c=>{const n=c.split('=')[0].trim(); if(n) deleteCookie(n)});}

    function renderCookieTable(){
      const box = document.getElementById('cookie-table');
      const cookies = document.cookie ? document.cookie.split(';').map(c=>c.trim()).filter(Boolean) : [];
      if(!cookies.length){ box.innerHTML = '<div class="muted">Keine Cookies gesetzt.</div>'; return; }
      let html = '<table><thead><tr><th>Name</th><th>Wert</th><th></th></tr></thead><tbody>';
      cookies.forEach(c=>{ const [k,v]=c.split('='); html += `<tr><td>${k}</td><td>${decodeURIComponent(v||'')}</td><td><button onclick="deleteCookie('${k}')" class="btn-ghost">L√∂schen</button></td></tr>` });
      html += '</tbody></table>';
      box.innerHTML = html;
      updateGreeting();
    }

    function updateGreeting(){
      const g = document.getElementById('greeting');
      const name = getCookie('username') || sessionStorage.getItem('username');
      g.textContent = name ? `Hallo, ${name}!` : 'Hallo, Sch√ºler!';
      document.getElementById('welcome-text').textContent = name ? `Angemeldet: ${name}` : 'Nicht angemeldet';
    }

    /* --------------------- Persistent vs Session Demo -------------------- */
    function saveNamePersistent(){ const name = document.getElementById('name-input').value.trim(); if(!name) return alert('Bitte Namen eingeben'); setCookie('username', name, 365); setCookie('theme','light',365); updateGreeting(); }
    function saveNameSession(){ const name = document.getElementById('name-input').value.trim(); if(!name) return alert('Bitte Namen eingeben'); sessionStorage.setItem('username', name); setSessionCookie('session_demo','1'); updateGreeting(); renderCookieTable(); }
    function setPersistentDemo(){ setCookie('demo_persistent','persistentValue',365); alert('Persistent Cookie gesetzt (l√§uft 365 Tage)'); }
    function setSessionDemo(){ setSessionCookie('demo_session','tempValue'); alert('Session Cookie gesetzt (verschwindet beim Schlie√üen des Tabs/Browsers)'); }

    /* --------------------- Device info -------------------- */
    function showDeviceInfo(){
      const info = {
        'User Agent': navigator.userAgent,
        'Sprache': navigator.language,
        'Cookies aktiviert': navigator.cookieEnabled,
        'Plattform': navigator.platform,
        'Bildschirm': `${window.screen.width}√ó${window.screen.height}`,
        'Zeitzone': Intl.DateTimeFormat().resolvedOptions().timeZone,
        'Uhrzeit': new Date().toLocaleString()
      };
      let text = '';
      for(const k in info) text += `‚Ä¢ ${k}: ${info[k]}\n`;
      document.getElementById('device-info').textContent = text;
      markStep(2);
    }
    function clearDeviceInfo(){ document.getElementById('device-info').textContent = 'Noch keine Daten angezeigt.'; }

    /* --------------------- Geolocation + Leaflet -------------------- */
    let map, marker;
    function getLocation(){
      const out = document.getElementById('location-info');
      const mapDiv = document.getElementById('map');
      if(!navigator.geolocation){ out.textContent = '‚ùå Geolocation nicht unterst√ºtzt.'; return; }
      out.textContent = 'üìç Standort wird abgefragt...';
      navigator.geolocation.getCurrentPosition(pos=>{
        const lat = pos.coords.latitude; const lon = pos.coords.longitude; const acc = pos.coords.accuracy;
        out.textContent = `‚úÖ Standort:\nBreitengrad: ${lat.toFixed(5)}\nL√§ngengrad: ${lon.toFixed(5)}\nGenauigkeit: ¬±${Math.round(acc)} m`;
        mapDiv.style.display = 'block';
        if(!map){ map = L.map('map').setView([lat,lon],13); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ attribution:'¬© OpenStreetMap-Mitwirkende' }).addTo(map); }
        else map.setView([lat,lon],13);
        if(marker) marker.remove(); marker = L.marker([lat,lon]).addTo(map).bindPopup('üìç Dein Standort').openPopup();
        markStep(3);
      }, err=>{ out.textContent = '‚ö†Ô∏è Standort konnte nicht ermittelt werden oder wurde abgelehnt.'; document.getElementById('map').style.display='none'; });
    }
    function clearLocation(){ document.getElementById('map').style.display='none'; document.getElementById('location-info').textContent='Noch keine Standortdaten.'; }

    /* --------------------- Tracking Simulation -------------------- */
    function setTracking(){ const id = Math.random().toString(36).slice(2,10); setCookie('tracking_id', id, 90); document.getElementById('tracking-info').textContent = `Tracking gesetzt: ${id}`; markStep(4); }
    function simulateAd(){ const id = getCookie('tracking_id'); if(!id) return alert('Kein Tracking gesetzt.'); // einfache Simulation: merken welche "Produktkategorie" besucht wurde
      const category = prompt('W√§hle eine Produktkategorie, um Targeting zu simulieren (z.B. Schuhe):','Schuhe'); if(!category) return;
      // speichern die letzte Kategorie per localStorage (simuliertes Cross-Site-Profil)
      localStorage.setItem('last_category', category);
      alert(`Simulierter Besuch: ${category}. Beim n√§chsten Besuch k√∂nnte eine Ad f√ºr ${category} erscheinen.`);
      document.getElementById('tracking-info').textContent = `Tracking aktiv (${id}). Letzte Kategorie: ${category}`;
    }
    function clearTracking(){ deleteCookie('tracking_id'); localStorage.removeItem('last_category'); document.getElementById('tracking-info').textContent = 'Tracking nicht gesetzt.'; }

    function simulateVisit(){ // simuliert einen erneuten Besuch: liest tracking und last_category
      const id = getCookie('tracking_id'); const cat = localStorage.getItem('last_category');
      if(id && cat){ alert(`Wiederkehrender Besuch erkannt. Tracking-ID ${id} ‚Üí m√∂gliche Ad f√ºr ${cat}`); }
      else if(id){ alert(`Wiederkehrender Besucher (Tracking-ID ${id}). Kein Kategorie-Profil vorhanden.`); }
      else { alert('Kein Tracking vorhanden ‚Äî Besucher erscheint neu.'); }
      // mark all steps lightly
      if(id) markStep(4); if(getCookie('username') || sessionStorage.getItem('username')) markStep(5);
    }

    /* --------------------- Mini Register / Login -------------------- */
    function registerUser(){ const u = document.getElementById('reg-username').value.trim(); const p = document.getElementById('reg-password').value; if(!u||!p) return alert('Username + Passwort erforderlich');
      // einfache lokale Speicherung (nur Demo):
      const users = JSON.parse(localStorage.getItem('demo_users')||'{}');
      if(users[u]) return alert('Benutzername existiert bereits');
      users[u] = { password: btoa(p) }; // NICHT sicher ‚Äî nur Demo
      localStorage.setItem('demo_users', JSON.stringify(users));
      alert('Registrierung erfolgreich (lokal). Du kannst dich jetzt einloggen.');
    }
    function loginUser(){ const u = document.getElementById('login-username').value.trim(); const p = document.getElementById('login-password').value; if(!u||!p) return alert('Bitte Username + Passwort eingeben');
      const users = JSON.parse(localStorage.getItem('demo_users')||'{}');
      if(!users[u] || users[u].password !== btoa(p)) return alert('Ung√ºltige Anmeldedaten');
      // setze Session-Cookie (keine expires): demonstriert Session-Cookie
      setSessionCookie('session_user', u);
      // au√üerdem setzen wir eine sessionStorage-Variable f√ºr UI
      sessionStorage.setItem('username', u);
      updateSessionInfo(); renderCookieTable(); markStep(5);
    }
    function logoutUser(){ sessionStorage.removeItem('username'); deleteCookie('session_user'); updateSessionInfo(); renderCookieTable(); }
    function updateSessionInfo(){ const s = sessionStorage.getItem('username'); document.getElementById('session-info').textContent = s ? `Eingeloggt als ${s} (Session-Cookie)` : 'Nicht eingeloggt.'; updateGreeting(); }

    /* --------------------- UI: Theme, Progress -------------------- */
    const themeToggle = document.getElementById('theme-toggle');
    themeToggle.addEventListener('click', ()=>{
      const root = document.body; const theme = root.getAttribute('data-theme');
      const next = theme==='light' ? 'dark' : 'light';
      root.setAttribute('data-theme', next); themeToggle.textContent = next==='dark' ? 'Light' : 'Dark';
      setCookie('theme_pref', next, 365);
    });

    function applySavedTheme(){ const t = getCookie('theme_pref'); if(t){ document.body.setAttribute('data-theme', t); themeToggle.textContent = t==='dark' ? 'Light' : 'Dark'; } }

    function markStep(n){ document.querySelectorAll('.step').forEach(el=>el.classList.toggle('active', Number(el.getAttribute('data-step'))===n)); }

    /* --------------------- Small actions -------------------- */
    function showAllCookies(){ renderCookieTable(); alert('Cookies wurden im Sidebar aktualisiert.'); }
    function clearAllCookies(){ if(confirm('Alle Cookies l√∂schen? Dies l√∂scht auch Session-Cookie (Login).')){ clearAllCookiesInternal(); }}
    function clearAllCookiesInternal(){ document.cookie.split(';').forEach(c=>{ const name = c.split('=')[0].trim(); if(name) deleteCookie(name); }); localStorage.removeItem('last_category'); sessionStorage.removeItem('username'); updateSessionInfo(); }

    /* --------------------- Init -------------------- */
    function init(){ renderCookieTable(); applySavedTheme(); updateSessionInfo(); updateGreeting(); // prefill fields for demo
      const storedName = getCookie('username'); if(storedName) document.getElementById('name-input').value = storedName;
    }

    // expose some functions to window for inline onclick handlers
    window.showDeviceInfo = showDeviceInfo; window.clearDeviceInfo = clearDeviceInfo; window.getLocation = getLocation; window.clearLocation = clearLocation;
    window.setTracking = setTracking; window.simulateAd = simulateAd; window.clearTracking = clearTracking;
    window.saveNamePersistent = saveNamePersistent; window.saveNameSession = saveNameSession; window.setPersistentDemo = setPersistentDemo; window.setSessionDemo = setSessionDemo;
    window.registerUser = registerUser; window.loginUser = loginUser; window.logoutUser = logoutUser; window.showAllCookies = renderCookieTable; window.clearAllCookies = clearAllCookies; window.simulateVisit = simulateVisit;

    // avoid name clash
    function clearAllCookies(){ clearAllCookiesInternal(); }

    // start
    init();
  </script>
</body>
</html>
