<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wie Websites dich erkennen ‚Äî Interaktive Demo (√úberarbeitet)</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    /* ------------------------------------- */
    /*  CSS Variables & Base Styles          */
    /* ------------------------------------- */
    :root {
      --color-bg: #f6f8fa;
      --color-card: #ffffff;
      --color-primary: #4a90e2;
      --color-text-muted: #6b7280;
      --color-glass: rgba(255, 255, 255, 0.6);
      --color-border: #e6edf5;
      --color-shadow: rgba(2, 6, 23, 0.08);
      --color-shadow-light: rgba(2, 6, 23, 0.04);
      --gradient-header: linear-gradient(90deg, var(--color-primary), #2e6fb8);
      --gradient-info: linear-gradient(180deg, rgba(234, 244, 255, 0.5), transparent);
    }

    [data-theme="dark"] {
      --color-bg: #0f1724;
      --color-card: #0b1220;
      --color-primary: #60a5fa;
      --color-text-muted: #9ca3af;
      --color-glass: rgba(255, 255, 255, 0.03);
      --color-border: #2d3748; /* Darker border for dark theme */
      --color-shadow: rgba(0, 0, 0, 0.2); /* Stronger shadow in dark theme */
      --color-shadow-light: rgba(0, 0, 0, 0.1);
      --gradient-header: linear-gradient(90deg, var(--color-primary), #3f6eb8);
      --gradient-info: linear-gradient(180deg, rgba(0, 50, 100, 0.3), transparent);
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    body {
      font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
      margin: 0;
      background: var(--color-bg);
      color: var(--color-text-muted);
      line-height: 1.5;
    }

    /* ------------------------------------- */
    /*  Typography                           */
    /* ------------------------------------- */
    h1, h2, h3 {
      color: var(--color-primary);
      margin-top: 0;
    }
    h1 { font-size: 1.1rem; }
    h2 { margin-bottom: 0.5rem; }
    h3 { margin-bottom: 0.5rem; }

    p { margin-top: 0; }

    .muted {
      font-size: 0.9rem;
      color: var(--color-text-muted);
    }

    pre {
      background: rgba(0, 0, 0, 0.03);
      padding: 0.75rem;
      border-radius: 8px;
      overflow: auto;
      font-size: 0.92rem;
      color: var(--color-text-muted);
      white-space: pre-wrap; /* Allows text to wrap in pre tags */
    }

    /* ------------------------------------- */
    /*  Layout & Structure                   */
    /* ------------------------------------- */
    header {
      background: var(--gradient-header);
      color: white;
      padding: 1.25rem 1rem;
      display: flex;
      gap: 1rem;
      align-items: center;
      justify-content: space-between;
    }
    header .brand {
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }
    header h1 {
      margin: 0;
      color: white;
    }
    header p {
      margin: 0;
      font-size: 0.86rem;
      opacity: 0.95;
    }

    main {
      max-width: 1100px;
      margin: 1.25rem auto;
      padding: 1rem;
    }

    .layout {
      display: grid;
      grid-template-columns: 380px 1fr; /* Sidebar breiter f√ºr mehr Platz */
      gap: 1rem;
    }

    .sidebar {
      position: sticky;
      top: 1rem;
      align-self: start;
    }

    .card {
      background: var(--color-card);
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 6px 20px var(--color-shadow);
      color: var(--color-text-muted);
    }

    .content {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    section {
      padding: 1rem;
      border-radius: 12px;
      background: var(--color-card);
      box-shadow: 0 6px 20px var(--color-shadow-light);
    }

    .info {
      background: var(--gradient-info);
      padding: 0.6rem;
      border-left: 4px solid var(--color-primary);
      border-radius: 8px;
      color: var(--color-text-muted);
    }

    footer {
      text-align: center;
      font-size: 0.82rem;
      color: var(--color-text-muted);
      margin-top: 1rem;
      padding-top: 1rem;
    }

    /* ------------------------------------- */
    /*  Components                           */
    /* ------------------------------------- */
    .progress {
      display: flex;
      gap: 0.5rem; /* Konsistenterer Abstand */
      align-items: center;
      margin-top: 0.5rem;
      overflow-x: auto;
      padding-bottom: 0.25rem;
    }
    .step {
      flex: 0 0 auto; /* Keine Schrumpfung oder Wachsen, feste Basisbreite */
      min-width: 68px;
      background: var(--color-glass);
      padding: 0.45rem 0.6rem;
      border-radius: 8px;
      text-align: center;
      font-weight: 600;
      color: var(--color-text-muted);
      cursor: pointer; /* Signalisiert, dass Schritte klickbar sein k√∂nnten */
    }
    .step.active {
      background: var(--gradient-header);
      color: white;
    }

    .controls {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-top: 0.7rem;
    }

    button {
      background: var(--color-primary);
      color: white;
      border: none;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.1s ease, background-color 0.1s ease;
    }
    .btn-ghost {
      background: transparent;
      color: var(--color-primary);
      border: 1px solid var(--color-glass);
    }
    button:active {
      transform: translateY(1px);
    }
    button:hover:not(:active) {
        opacity: 0.9;
    }


    .form-row {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.6rem;
      flex-wrap: wrap; /* Damit es auf kleinen Bildschirmen umbricht */
    }
    input[type=text],
    input[type=password] {
      flex: 1;
      min-width: 150px; /* Mindestbreite f√ºr Eingabefelder */
      padding: 0.5rem 0.6rem;
      border-radius: 8px;
      border: 1px solid var(--color-border);
      font-size: 0.95rem;
      background: var(--color-card); /* Ensure background is set for dark mode */
      color: var(--color-text-muted);
    }
    input[type=text]:focus,
    input[type=password]:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
    }

    label {
      font-weight: 600;
      font-size: 0.95rem;
      color: var(--color-text-muted);
    }

    #map {
      height: 280px;
      border-radius: 8px;
      margin-top: 0.6rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0.6rem;
    }
    th,
    td {
      padding: 0.45rem 0.5rem;
      text-align: left;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      font-size: 0.9rem;
    }
    th {
      color: var(--color-text-muted);
    }

    .badge {
      display: inline-block;
      padding: 0.2rem 0.45rem;
      border-radius: 999px;
      font-size: 0.78rem;
      background: var(--color-glass);
      color: var(--color-text-muted);
    }

    /* ------------------------------------- */
    /*  Responsive Design                    */
    /* ------------------------------------- */
    @media (max-width: 880px) {
      .layout {
        grid-template-columns: 1fr;
      }
      .sidebar {
        position: static;
      }
      .form-row {
        flex-direction: column; /* Stapeln der Elemente im Formular auf kleinen Bildschirmen */
      }
      input[type=text], input[type=password] {
          width: 100%; /* Volle Breite f√ºr Inputs */
          min-width: unset;
      }
    }
  </style>
</head>
<body data-theme="light">
  <header>
    <div class="brand">
      <div style="font-size:1.5rem">üç™</div>
      <div>
        <h1>Wie Websites dich erkennen</h1>
        <p>Interaktive Unterrichts-Demo ‚Äì Schulstufe: 9. Klasse / AHS 5. Klasse</p>
      </div>
    </div>
    <div style="display:flex; gap:.6rem; align-items:center">
      <div class="muted" id="welcome-text">Willkommen!</div>
      <button id="theme-toggle" class="btn-ghost">Dark</button>
    </div>
  </header>

  <main>
    <div class="layout">
      <aside class="sidebar">
        <div class="card">
          <h2>Schritt-f√ºr-Schritt</h2>
          <div class="muted">F√ºhre die Schritte durch, um Cookies & Tracking zu verstehen.</div>
          <div class="progress" id="progress">
            <div class="step" data-step="1">1. Cookies</div>
            <div class="step" data-step="2">2. Ger√§t</div>
            <div class="step" data-step="3">3. Standort</div>
            <div class="step" data-step="4">4. Tracking</div>
            <div class="step" data-step="5">5. Login</div>
          </div>

          <div style="margin-top:.8rem" class="muted">Schnellaktionen</div>
          <div class="controls">
            <button onclick="renderCookieTable()">Cookies anzeigen</button>
            <button onclick="clearAllCookies()" class="btn-ghost">Alle l√∂schen</button>
            <button onclick="simulateVisit()" class="btn-ghost">Seite neu laden (sim.)</button>
          </div>

          <div style="margin-top:.8rem" class="muted">Cookie-√úbersicht</div>
          <div id="cookie-table"></div>
        </div>

        <div style="height:1rem"></div>

        <div class="card">
          <h2>Session vs Persistent</h2>
          <div class="muted">Session-Cookies existieren nur w√§hrend einer Browser-Sitzung. Persistente Cookies haben ein Ablaufdatum.</div>
          <div style="margin-top:.6rem; display:flex; gap:.5rem">
            <button onclick="setPersistentDemo()">Persistent setzen</button>
            <button onclick="setSessionDemo()" class="btn-ghost">Session setzen</button>
          </div>
        </div>
      </aside>

      <section class="content">
        <section class="card">
          <h3>üç™ Cookies ‚Äì pers√∂nliche Begr√º√üung & Demo</h3>
          <div class="info">Diese Sektion zeigt wie persistent gespeicherte Cookies (z. B. Name) und Session-Cookies (Login-Sitzung) funktionieren. Es werden <b>keine</b> echten Tracker gesetzt.</div>

          <div style="margin-top:.6rem">
            <div class="form-row">
              <input id="name-input" type="text" placeholder="Name (z. B. Anna)" />
              <button onclick="saveNamePersistent()">Als Persistent speichern</button>
              <button onclick="saveNameSession()" class="btn-ghost">Als Session speichern</button>
            </div>
            <div style="margin-top:.5rem" class="muted">Aktuelle Begr√º√üung:</div>
            <pre id="greeting">Hallo, Sch√ºler!</pre>
          </div>
        </section>

        <section class="card">
          <h3>üíª Ger√§tedaten</h3>
          <div class="info">Technische Informationen, die Websites mit JavaScript auslesen k√∂nnen.</div>
          <div style="margin-top:.6rem; display:flex; gap:.5rem; align-items:center">
            <button onclick="showDeviceInfo()">Daten anzeigen</button>
            <button onclick="clearDeviceInfo()" class="btn-ghost">L√∂schen</button>
          </div>
          <pre id="device-info">Noch keine Daten angezeigt.</pre>
        </section>

        <section class="card">
          <h3>üìç Standort (nur mit Zustimmung)</h3>
          <div class="info">Wenn erlaubt, zeigt die Karte ungef√§hr, wo sich das Ger√§t befindet.</div>
          <div style="margin-top:.6rem; display:flex; gap:.5rem; align-items:center">
            <button onclick="getLocation()">Standort abfragen</button>
            <button onclick="clearLocation()" class="btn-ghost">Karte verstecken</button>
          </div>
          <pre id="location-info">Noch keine Standortdaten.</pre>
          <div id="map" style="display:none"></div>
        </section>

        <section class="card">
          <h3>üì¢ Tracking-Simulation</h3>
          <div class="info">Simuliere ein Werbecookie (tracking_id) und beobachte, wie eine Seite dich bei einem erneuten Besuch "wiedererkennen" k√∂nnte.</div>
          <div style="margin-top:.6rem; display:flex; gap:.5rem; align-items:center">
            <button onclick="setTracking()">Tracking setzen</button>
            <button onclick="simulateAd()" class="btn-ghost">Simuliere Ad-Targeting</button>
            <button onclick="clearTracking()" class="btn-ghost">Tracking l√∂schen</button>
          </div>
          <pre id="tracking-info">Tracking nicht gesetzt.</pre>
        </section>

        <section class="card">
          <h3>üîê Mini-Register / Login (lokal & ohne Server)</h3>
          <div class="info">Registrieren & Anmelden werden nur lokal simuliert. Registrierte Daten werden im <b>localStorage</b> gespeichert. Die Login-Sitzung demonstriert einen Session-Cookie.</div>

          <div style="margin-top:.6rem">
            <div class="form-row">
              <input id="reg-username" type="text" placeholder="Benutzername" />
              <input id="reg-password" type="password" placeholder="Passwort" />
              <button onclick="registerUser()">Registrieren</button>
            </div>

            <div class="form-row" style="margin-top:.5rem">
              <input id="login-username" type="text" placeholder="Benutzername" />
              <input id="login-password" type="password" placeholder="Passwort" />
              <button onclick="loginUser()">Login</button>
              <button onclick="logoutUser()" class="btn-ghost">Logout</button>
            </div>

            <div style="margin-top:.6rem" class="muted">Session-Info:</div>
            <pre id="session-info">Nicht eingeloggt.</pre>
          </div>
        </section>

        <footer>¬© Unterrichts-Demo ‚Äì Keine Daten werden an Server √ºbertragen.</footer>
      </section>
    </div>
  </main>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    /* ----------------------------- Helpers ----------------------------- */
    /**
     * Setzt einen Cookie. Wenn `days` null oder undefined ist, wird es ein Session-Cookie.
     * @param {string} name - Der Name des Cookies.
     * @param {string} value - Der Wert des Cookies.
     * @param {number|null} [days] - Anzahl der Tage, bis der Cookie abl√§uft (f√ºr persistente Cookies).
     */
    function setCookie(name, value, days) {
      let cookieString = `${name}=${encodeURIComponent(value)}; path=/`;
      if (typeof days === 'number' && days > 0) {
        const d = new Date();
        d.setTime(d.getTime() + days * 24 * 60 * 60 * 1000);
        cookieString += `; expires=${d.toUTCString()}`;
      }
      document.cookie = cookieString;
      renderCookieTable(); // Tabelle nach jeder Cookie-√Ñnderung aktualisieren
    }

    /**
     * Holt den Wert eines Cookies.
     * @param {string} name - Der Name des Cookies.
     * @returns {string|null} Der Wert des Cookies oder null, wenn nicht gefunden.
     */
    function getCookie(name) {
      const match = document.cookie.match(`(^|;)\\s*${name}=([^;]+)`);
      return match ? decodeURIComponent(match.pop()) : null;
    }

    /**
     * L√∂scht einen Cookie.
     * @param {string} name - Der Name des zu l√∂schenden Cookies.
     */
    function deleteCookie(name) {
      document.cookie = `${name}=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC`;
      renderCookieTable(); // Tabelle nach jeder Cookie-√Ñnderung aktualisieren
    }

    /**
     * Rendert die Cookie-Tabelle im Sidebar.
     */
    function renderCookieTable() {
      const box = document.getElementById('cookie-table');
      // Cookies werden direkt von document.cookie geparst, da clearAllCookies jetzt auch darauf aufbaut
      const cookies = document.cookie
        .split(';')
        .map(c => c.trim())
        .filter(Boolean); // Leere Strings entfernen

      if (!cookies.length) {
        box.innerHTML = '<div class="muted">Keine Cookies gesetzt.</div>';
        return;
      }

      let html = '<table><thead><tr><th>Name</th><th>Wert</th><th></th></tr></thead><tbody>';
      cookies.forEach(c => {
        const [key, val] = c.split('=');
        html += `<tr><td>${key}</td><td>${decodeURIComponent(val || '')}</td><td><button onclick="deleteCookie('${key}')" class="btn-ghost">L√∂schen</button></td></tr>`;
      });
      html += '</tbody></table>';
      box.innerHTML = html;
      updateGreeting(); // Begr√º√üung aktualisieren, falls der Benutzername-Cookie ge√§ndert wurde
    }

    /**
     * Aktualisiert den Begr√º√üungstext und den Willkommenstext im Header.
     */
    function updateGreeting() {
      const greetingElement = document.getElementById('greeting');
      const welcomeTextElement = document.getElementById('welcome-text');
      const name = getCookie('username') || sessionStorage.getItem('username'); // Bevorzugt persistent, dann session

      greetingElement.textContent = name ? `Hallo, ${name}!` : 'Hallo, Sch√ºler!';
      welcomeTextElement.textContent = name ? `Angemeldet: ${name}` : 'Willkommen!';
    }

    /* --------------------- Persistent vs Session Demo -------------------- */
    function saveNamePersistent() {
      const name = document.getElementById('name-input').value.trim();
      if (!name) return alert('Bitte Namen eingeben');
      setCookie('username', name, 365); // Persistenter Cookie
      updateGreeting();
    }

    function saveNameSession() {
      const name = document.getElementById('name-input').value.trim();
      if (!name) return alert('Bitte Namen eingeben');
      sessionStorage.setItem('username', name); // SessionStorage f√ºr Demo
      setCookie('session_demo', '1'); // Einfacher Session-Cookie, kein expires
      updateGreeting();
      renderCookieTable();
    }

    function setPersistentDemo() {
      setCookie('demo_persistent', 'persistentValue', 365);
      alert('Persistent Cookie "demo_persistent" gesetzt (l√§uft 365 Tage)');
    }

    function setSessionDemo() {
      setCookie('demo_session', 'tempValue'); // Session Cookie, kein expires
      alert('Session Cookie "demo_session" gesetzt (verschwindet beim Schlie√üen des Tabs/Browsers)');
    }

    /* --------------------- Device info -------------------- */
    function showDeviceInfo() {
      const info = {
        'User Agent': navigator.userAgent,
        'Sprache': navigator.language,
        'Cookies aktiviert': navigator.cookieEnabled,
        'Plattform': navigator.platform,
        'Bildschirm': `${window.screen.width}√ó${window.screen.height}`,
        'Zeitzone': Intl.DateTimeFormat().resolvedOptions().timeZone,
        'Uhrzeit': new Date().toLocaleString()
      };
      let text = '';
      for (const k in info) text += `‚Ä¢ ${k}: ${info[k]}\n`;
      document.getElementById('device-info').textContent = text;
      markStep(2);
    }

    function clearDeviceInfo() {
      document.getElementById('device-info').textContent = 'Noch keine Daten angezeigt.';
    }

    /* --------------------- Geolocation + Leaflet -------------------- */
    let map, marker;

    function getLocation() {
      const out = document.getElementById('location-info');
      const mapDiv = document.getElementById('map');
      if (!navigator.geolocation) {
        out.textContent = '‚ùå Geolocation nicht unterst√ºtzt.';
        return;
      }
      out.textContent = 'üìç Standort wird abgefragt...';
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        const acc = pos.coords.accuracy;
        out.textContent = `‚úÖ Standort:\nBreitengrad: ${lat.toFixed(5)}\nL√§ngengrad: ${lon.toFixed(5)}\nGenauigkeit: ¬±${Math.round(acc)} m`;
        mapDiv.style.display = 'block';

        if (!map) {
          map = L.map('map').setView([lat, lon], 13);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap-Mitwirkende'
          }).addTo(map);
        } else {
          map.setView([lat, lon], 13);
        }

        if (marker) marker.remove();
        marker = L.marker([lat, lon]).addTo(map).bindPopup('üìç Dein Standort').openPopup();
        markStep(3);
      }, err => {
        out.textContent = '‚ö†Ô∏è Standort konnte nicht ermittelt werden oder wurde abgelehnt.';
        mapDiv.style.display = 'none'; // Karte auch ausblenden, wenn abgelehnt
      });
    }

    function clearLocation() {
      document.getElementById('map').style.display = 'none';
      document.getElementById('location-info').textContent = 'Noch keine Standortdaten.';
      if (marker) {
        marker.remove();
        marker = null;
      }
      if (map) {
        map.remove(); // Map-Instanz vollst√§ndig entfernen
        map = null;
      }
    }

    /* --------------------- Tracking Simulation -------------------- */
    function setTracking() {
      const id = Math.random().toString(36).slice(2, 10);
      setCookie('tracking_id', id, 90);
      document.getElementById('tracking-info').textContent = `Tracking gesetzt: ${id}`;
      markStep(4);
    }

    function simulateAd() {
      const id = getCookie('tracking_id');
      if (!id) return alert('Kein Tracking gesetzt.');

      const category = prompt('W√§hle eine Produktkategorie, um Targeting zu simulieren (z.B. Schuhe):', 'Schuhe');
      if (!category) return;

      localStorage.setItem('last_category', category); // Speichert die letzte Kategorie per localStorage (simuliertes Cross-Site-Profil)
      alert(`Simulierter Besuch: ${category}. Beim n√§chsten Besuch k√∂nnte eine Ad f√ºr ${category} erscheinen.`);
      document.getElementById('tracking-info').textContent = `Tracking aktiv (${id}). Letzte Kategorie: ${category}`;
    }

    function clearTracking() {
      deleteCookie('tracking_id');
      localStorage.removeItem('last_category');
      document.getElementById('tracking-info').textContent = 'Tracking nicht gesetzt.';
      renderCookieTable(); // Aktualisiert die Cookie-Tabelle
    }

    function simulateVisit() {
      const id = getCookie('tracking_id');
      const cat = localStorage.getItem('last_category');

      if (id && cat) {
        alert(`Wiederkehrender Besuch erkannt. Tracking-ID ${id} ‚Üí m√∂gliche Ad f√ºr ${cat}`);
      } else if (id) {
        alert(`Wiederkehrender Besucher (Tracking-ID ${id}). Kein Kategorie-Profil vorhanden.`);
      } else {
        alert('Kein Tracking vorhanden ‚Äî Besucher erscheint neu.');
      }
      // Schritte markieren, wenn Daten vorhanden sind
      if (id) markStep(4);
      if (getCookie('username') || sessionStorage.getItem('username')) markStep(5);
      if (getCookie('theme_pref')) markStep(1); // Theme-Cookie ist auch ein Cookie
    }

    /* --------------------- Mini Register / Login -------------------- */
    function registerUser() {
      const usernameInput = document.getElementById('reg-username');
      const passwordInput = document.getElementById('reg-password');
      const u = usernameInput.value.trim();
      const p = passwordInput.value;

      if (!u || !p) return alert('Benutzername + Passwort erforderlich');

      const users = JSON.parse(localStorage.getItem('demo_users') || '{}');
      if (users[u]) return alert('Benutzername existiert bereits');

      users[u] = {
        password: btoa(p)
      }; // ACHTUNG: btoa ist NICHT sicher f√ºr Passw√∂rter! Nur f√ºr Demo-Zwecke.
      localStorage.setItem('demo_users', JSON.stringify(users));
      alert('Registrierung erfolgreich (lokal). Du kannst dich jetzt einloggen.');

      usernameInput.value = ''; // Felder nach Registrierung leeren
      passwordInput.value = '';
    }

    function loginUser() {
      const usernameInput = document.getElementById('login-username');
      const passwordInput = document.getElementById('login-password');
      const u = usernameInput.value.trim();
      const p = passwordInput.value;

      if (!u || !p) return alert('Bitte Benutzername + Passwort eingeben');

      const users = JSON.parse(localStorage.getItem('demo_users') || '{}');
      if (!users[u] || users[u].password !== btoa(p)) return alert('Ung√ºltige Anmeldedaten');

      setCookie('session_user', u); // Setzt Session-Cookie f√ºr Login-Status
      sessionStorage.setItem('username', u); // Auch in sessionStorage f√ºr UI
      updateSessionInfo();
      renderCookieTable();
      markStep(5);

      usernameInput.value = ''; // Felder nach Login leeren
      passwordInput.value = '';
    }

    function logoutUser() {
      sessionStorage.removeItem('username');
      deleteCookie('session_user');
      updateSessionInfo();
      renderCookieTable();
      alert('Du wurdest ausgeloggt.');
    }

    function updateSessionInfo() {
      const sessionUser = sessionStorage.getItem('username');
      document.getElementById('session-info').textContent = sessionUser ? `Eingeloggt als ${sessionUser} (Session-Cookie)` : 'Nicht eingeloggt.';
      updateGreeting();
    }

    /* --------------------- UI: Theme, Progress -------------------- */
    const themeToggle = document.getElementById('theme-toggle');
    themeToggle.addEventListener('click', () => {
      const root = document.body;
      const theme = root.getAttribute('data-theme');
      const nextTheme = theme === 'light' ? 'dark' : 'light';
      root.setAttribute('data-theme', nextTheme);
      themeToggle.textContent = nextTheme === 'dark' ? 'Light' : 'Dark';
      setCookie('theme_pref', nextTheme, 365); // Speichert die Theme-Pr√§ferenz
    });

    function applySavedTheme() {
      const savedTheme = getCookie('theme_pref');
      if (savedTheme) {
        document.body.setAttribute('data-theme', savedTheme);
        themeToggle.textContent = savedTheme === 'dark' ? 'Light' : 'Dark';
      }
    }

    function markStep(n) {
      document.querySelectorAll('.step').forEach(el => {
        el.classList.toggle('active', Number(el.getAttribute('data-step')) === n);
      });
    }

    /* --------------------- Small actions -------------------- */
    // Diese Funktion ist redundant, da renderCookieTable() bereits als onclick-Handler gesetzt werden kann
    // function showAllCookies() {
    //   renderCookieTable();
    //   alert('Cookies wurden im Sidebar aktualisiert.');
    // }

    function clearAllCookies() {
      if (confirm('Alle Cookies, LocalStorage und SessionStorage l√∂schen? Dies l√∂scht auch Login-Sessions und Tracking-Daten.')) {
        // Alle Cookies l√∂schen
        document.cookie.split(';').forEach(c => {
          const name = c.split('=')[0].trim();
          if (name) deleteCookie(name); // Nutzt die deleteCookie Funktion, die auch die Tabelle aktualisiert
        });

        // Alle LocalStorage-Eintr√§ge l√∂schen
        localStorage.clear();

        // Alle SessionStorage-Eintr√§ge l√∂schen
        sessionStorage.clear();

        // UI-Elemente aktualisieren
        updateSessionInfo();
        updateGreeting();
        document.getElementById('device-info').textContent = 'Noch keine Daten angezeigt.';
        document.getElementById('tracking-info').textContent = 'Tracking nicht gesetzt.';
        clearLocation(); // Stellt sicher, dass die Karte ausgeblendet und resettet wird
        renderCookieTable(); // Stellt sicher, dass die Cookie-Tabelle leer ist
        alert('Alle Daten gel√∂scht.');
      }
    }

    /* --------------------- Init -------------------- */
    function init() {
      renderCookieTable();
      applySavedTheme();
      updateSessionInfo();
      updateGreeting();

      // Felder f√ºr Demo vorausf√ºllen
      const storedName = getCookie('username');
      if (storedName) document.getElementById('name-input').value = storedName;
    }

    // Startet die Initialisierungsfunktion, wenn das DOM geladen ist.
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>